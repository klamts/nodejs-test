<form id="reportForm" enctype="multipart/form-data">
  <label>TÃªn sÃ¡ch:</label><br>
  <input type="text" name="book_title" required><br><br>

  <label>ChÆ°Æ¡ng:</label><br>
  <textarea name="chapter" rows="2" cols="50" required></textarea><br><br>  

  <label>Cáº£m nháº­n:</label><br>
  <textarea name="reflection" rows="5" cols="50" required></textarea><br><br>
    <button id="start">ğŸ¤ Báº¯t Ä‘áº§u ghi</button>
    <button id="stop">â¹ï¸ Dá»«ng ghi</button>
    <audio id="audio" controls></audio>

  <button type="button" onclick="submitWithAudio()">ğŸ“¤ Gá»­i kÃ¨m ghi Ã¢m</button>
</form>
<script>
let mediaRecorder;
let audioChunks = [];
let audioBlob = null;

document.getElementById('start').onclick = async () => {
  const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
  mediaRecorder = new MediaRecorder(stream);
  audioChunks = [];
  mediaRecorder.start();

  mediaRecorder.ondataavailable = e => audioChunks.push(e.data);
};

document.getElementById('stop').onclick = () => {
  mediaRecorder.stop();
  mediaRecorder.onstop = () => {
    audioBlob = new Blob(audioChunks, { type: 'audio/webm' });
    document.getElementById('audio').src = URL.createObjectURL(audioBlob);
  };
};

// function submitWithAudio() {
//   const form = document.getElementById('reportForm');
//   const formData = new FormData(form);

//   // Láº¥y cÃ¡c giÃ¡ trá»‹ tá»« form
//   const bookTitle = formData.get('book_title');
//   const chapter = formData.get('chapter');
//   const reflection = formData.get('reflection');

//   // Náº¿u cÃ³ file ghi Ã¢m
//   if (audioBlob) {
//     formData.append('audio', audioBlob, 'recording.webm');
//   }

//   fetch('/book-report', {
//     method: 'POST',
//     body: formData
//   })
//   .then(res => res.text())
//   .then(msg => {
//     // Hiá»ƒn thá»‹ thÃ´ng bÃ¡o vá»›i thÃ´ng tin Ä‘Ã£ gá»­i
//     alert(`ThÃ´ng tin Ä‘Ã£ Ä‘Æ°á»£c gá»­i!\nTÃªn sÃ¡ch: ${bookTitle}\nChÆ°Æ¡ng: ${chapter}\nCáº£m nháº­n: ${reflection}\nGhi Ã¢m: ${audioBlob ? 'ÄÃ£ gá»­i' : 'ChÆ°a cÃ³ ghi Ã¢m'}`);

//     // Reset form vÃ  audio
//     form.reset();
//     document.getElementById('audio').src = '';
//     audioBlob = null;
//   });
// }
function submitWithAudio() {
  const form = document.getElementById('reportForm');
  const formData = new FormData(form);

  // Kiá»ƒm tra náº¿u cÃ³ ghi Ã¢m
  if (audioBlob) {
    formData.append('audio', audioBlob, 'recording.webm');
  }

  fetch('/book-report', {
    method: 'POST',
    body: formData
  })
  .then(res => res.text())
  .then(msg => {
    // Láº¥y thÃ´ng tin tá»« form
    const bookTitle = form.book_title.value;
    const chapter = form.chapter.value;
    const reflection = form.reflection.value;

    // Láº¥y thÃ´ng tin thÆ° má»¥c ghi Ã¢m (á»Ÿ Ä‘Ã¢y giáº£ sá»­ báº¡n cÃ³ Ä‘Æ°á»ng dáº«n file)
    const audioDirectory = audioBlob ? `${audioBlob.name}` : 'KhÃ´ng cÃ³ ghi Ã¢m';

    // Hiá»ƒn thá»‹ thÃ´ng bÃ¡o
    alert(`ThÃ´ng tin Ä‘Ã£ Ä‘Æ°á»£c gá»­i!\nTÃªn sÃ¡ch: ${bookTitle}\nChÆ°Æ¡ng: ${chapter}\nCáº£m nháº­n: ${reflection}\nGhi Ã¢m: ${audioBlob ? 'ÄÃ£ gá»­i' : 'ChÆ°a cÃ³ ghi Ã¢m'}\nThÆ° má»¥c ghi Ã¢m: ${audioDirectory}`);
    
    // Reset form vÃ  audio sau khi gá»­i
    form.reset();
    document.getElementById('audio').src = '';
    audioBlob = null;
  });
}

</script>

